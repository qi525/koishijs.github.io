(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{423:function(t,s,a){"use strict";a.r(s);var l=a(25),c=Object(l.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"使用数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用数据库"}},[t._v("#")]),t._v(" 使用数据库")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("本节所介绍的内容需要你安装一个数据库支持。如果你暂时不打算使用数据库，那么可以略过。")])]),t._v(" "),a("p",[t._v("在之前的章节中，我们已经看到 Koishi 内部实现了一套权限管理系统，这需要对数据库的支持。但是另一方面，为了保证纯粹性，Koishi 的核心库 koishi-core 并不希望写入对某个具体的数据库的支持。因此，Koishi 的数据库采取了注入的方法。因此插件开发者大可不必同时担心 Koishi 使用了自己不了解的数据库框架——因为任何数据库在 Koishi 的调用中都提供了相同的接口。")]),t._v(" "),a("h2",{attrs:{id:"调用数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用数据库"}},[t._v("#")]),t._v(" 调用数据库")]),t._v(" "),a("h3",{attrs:{id:"安装数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装数据库"}},[t._v("#")]),t._v(" 安装数据库")]),t._v(" "),a("p",[t._v("正如上面所说的，如果你是插件开发者，你可能不需要关心具体的数据库实现（除非你本身需要新的表来存储数据）。但是如果你是 Koishi 的使用者，只有当安装了数据库你才能正常使用所有的特性。首先你需要安装数据库依赖：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{type:"package-manager"},scopedSlots:t._u([{key:"npm",fn:function(){return[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#032f62"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#9F9F9F"}},[t._v("# 我们以 mysql 数据库为例")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#FFFF00"}},[t._v("npm")]),a("span",{staticStyle:{color:"#FFFFFF"}},[t._v(" i koishi-plugin-mysql -D")])])])])]},proxy:!0},{key:"yarn",fn:function(){return[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#032f62"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#9F9F9F"}},[t._v("# 我们以 mysql 数据库为例")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#FFFF00"}},[t._v("yarn")]),a("span",{staticStyle:{color:"#FFFFFF"}},[t._v(" add koishi-plugin-mysql -D")])])])])]},proxy:!0}])}),t._v(" "),a("p",[t._v("然后与你添加插件同样的方法配置你的数据库：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:"koishi.config.js"}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#66D9EF"}},[t._v("module")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(".")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("exports")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  plugins: {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    mysql: {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      host: ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'[host]'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(",")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      port: ")]),a("span",{staticStyle:{color:"#AE81FF"}},[t._v("3306")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(",")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      user: ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'root'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(",")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      password: ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'[password]'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(",")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      database: ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'[database]'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(",")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    },")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  },")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])])])])]),a("p",[t._v("运行程序后，你就可以通过访问 "),a("code",[t._v("ctx.database")]),t._v(" 来调用数据库接口了：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 获取用户数据")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#66D9EF"}},[t._v("const")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" user ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("await")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ctx.database.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("getUser")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(type, id)")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 修改群数据")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("await")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ctx.database.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("setChannel")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(type, id, { assignee: ")]),a("span",{staticStyle:{color:"#AE81FF"}},[t._v("123456789")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" })")])])])])]),a("p",[t._v("你可以在后面的 API 文档中看到全部内置的 "),a("RouterLink",{attrs:{to:"/api/database.html"}},[t._v("数据库方法")]),t._v("。不过在这里我先介绍一下 Koishi 的数据库接口的几种设计，方便理解。")],1),t._v(" "),a("h3",{attrs:{id:"常见的接口设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的接口设计"}},[t._v("#")]),t._v(" 常见的接口设计")]),t._v(" "),a("p",[t._v("下面的代码展示了一个 Koishi 数据库最常见的接口设计，它广泛地运用于各种插件中：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 向数据库中获取一行，可以采用 getXXX(id, fields) 的形式")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 其中 id 是该行的标识符，fields 是需要的字段")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 对于有些数据库这个参数是自动忽略的，无论填写什么都会返回一切字段")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 如果该行存在则返回该行的对应字段，否则返回 null")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.database.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("getSchedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(id, fields)")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 向数据库中添加一行，可以采用 createXXX(data) 的形式")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 其中 data 是一个键值对；返回值是添加的行的完整数据（包括自动生成的 id 和默认属性等）")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.database.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("createSchedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(data)")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 修改数据库中的一行，可以采用 setXXX(id, data) 的形式")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 其中 id 是该行的标识符，data 是要更改的数据")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 修改时只会用 data 中的键进行覆盖，不会影响未记录在 data 中的资源")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.database.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("setSchedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(id, data)")])])])])]),a("h3",{attrs:{id:"获取数据的高级方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取数据的高级方法"}},[t._v("#")]),t._v(" 获取数据的高级方法")]),t._v(" "),a("p",[t._v("对于 Koishi 内部的两个抽象表 User 和 Channel，情况略有不同。我们在此基础上设计了几个高级方法，你可以在 "),a("RouterLink",{attrs:{to:"/api/session.html"}},[t._v("会话对象")]),t._v(" 中找到它们。")],1),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 中间增加了一个第二参数，表示默认情况下的权限等级")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 如果找到该用户，则返回该用户本身")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 否则创建一个新的用户数据，权限为 authority")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 如果 authority 大于 0，则将新的用户数据添加到表中")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("session.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("getUser")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(id, authority, fields)")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 在当前会话上绑定一个可观测用户实例")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 也就是所谓的 session.$user")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("session.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("observeUser")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(fields)")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 中间增加了一个第二参数，表示默认情况下的 assignee")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 如果找到该频道，则不修改任何数据，返回该频道本身")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 如果未找到该频道，则创建一个新的频道，代理者为 selfId")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 如果 selfId 大于 0，则将新的频道数据添加到表中")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("session.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("getChannel")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(id, selfId, fields)")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 在当前会话上绑定一个可观测频道实例")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 也就是所谓的 session.$channel")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("session.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("observeChannel")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(fields)")])])])])]),a("h2",{attrs:{id:"扩展数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展数据库"}},[t._v("#")]),t._v(" 扩展数据库")]),t._v(" "),a("p",[t._v("由于 Koishi 的数据库实现使用了注入策略，因此无论是字段，表，方法还是数据库都是可以扩展的。")]),t._v(" "),a("h3",{attrs:{id:"扩展用户和频道字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展用户和频道字段"}},[t._v("#")]),t._v(" 扩展用户和频道字段")]),t._v(" "),a("p",[t._v("向内置的 User 和 Channel 两张表中注入字段的方式如下：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { User } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi'")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 向用户数据库中注入字段 foo，默认值为 'bar'")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("User.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("extend")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(() ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("=>")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ({ foo: ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'bar'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" }))")])])])])]),a("p",[t._v("如果你是 TypeScript 用户，你可能还需要进行定义合并：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { User } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi'")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("declare")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("module")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-core/dist/database'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("interface")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("User")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    foo")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("string")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  }")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("User.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("extend")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(() ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("=>")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ({ foo: ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'bar'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" }))")])])])])]),a("h3",{attrs:{id:"扩展方法和表实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展方法和表实现"}},[t._v("#")]),t._v(" 扩展方法和表实现")]),t._v(" "),a("p",[t._v("要添加新的数据库方法，只需调用 "),a("code",[t._v("extendDatabase()")]),t._v("：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { extendDatabase } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi'")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 第一个参数声明这个方法依赖于 mysql 数据库")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 第二个参数表明这次调用注入的是 user 表")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#A6E22E"}},[t._v("extendDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-plugin-mysql'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#88846F"}},[t._v("// 要扩展的方法实现")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("createSchedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("...")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("args")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(") {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#88846F"}},[t._v("// 此时这里的 this 实际上是一个 MysqlDatabase 对象")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("return")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("this")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(".")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("query")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(sql)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  },")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("})")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("ctx.database.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("myMethod")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("...")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("args)")])])])])]),a("p",[t._v("请放心，这么做并不需要你引入 koishi-plugin-mysql 作为插件的依赖。")]),t._v(" "),a("p",[t._v("如果你是 TypeScript 用户，你可能还需要进行定义合并：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 你应该将 koishi-plugin-mysql 作为插件的 devDependency")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("type")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" MysqlDatabase ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-plugin-mysql'")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { extendDatabase } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi'")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 导出这张表的接口可以方便别人向这张表注入新的字段")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("export")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("interface")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Schedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  foo")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("string")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("declare")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("module")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-core/dist/database'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("interface")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Database")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("createSchedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("...")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("args")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(")")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Promise")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("<")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Schedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(">")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  }")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// 这里需要手动标明类型参数为 MysqlDatabase")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#A6E22E"}},[t._v("extendDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("<")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("MysqlDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(">(")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'mysql'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("createSchedule")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("...")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("args")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(") {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#88846F"}},[t._v("// 这里已经可以进行类型推断了")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("return")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("this")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(".")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("query")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(sql)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  },")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("})")])])])])]),a("h3",{attrs:{id:"编写数据库支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写数据库支持"}},[t._v("#")]),t._v(" 编写数据库支持")]),t._v(" "),a("p",[t._v("最后，让我们介绍一下如何编写一个数据库支持。与上面介绍的方法类似，我们也采用注入的方式，不过这次我们需要先实现一个类。我们用 mysql 来举个例子：")]),t._v(" "),a("p",[t._v("对于 TypeScript 的使用者，你可以像这样进行类型合并：")]),t._v(" "),a("panel-view",{staticClass:"code",attrs:{title:""}},[a("pre",{staticClass:"shiki",staticStyle:{"background-color":"#272822"}},[a("code",[a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { createPool, Pool, PoolConfig } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'mysql'")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("import")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" { extendDatabase } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("from")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi'")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("declare")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("module")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'koishi-core/dist/database'")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("interface")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Database")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("extends")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("MysqlDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {}")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("export")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("default")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("class")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("MysqlDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("private")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" pool")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Pool")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("constructor")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("config")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("PoolConfig")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {}) {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("this")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(".pool ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("createPool")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(config)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  }")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("query")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("sql")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("string")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("values")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("?:")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("any")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(")")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Promise")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("<")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("any")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("> {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("return")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("new")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Promise")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("((")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("resolve")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("reject")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(") ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("=>")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("this")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(".pool.")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("query")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(sql, values, (")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("error")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("results")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("fields")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(") ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("=>")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("        ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("if")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" (error) {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("          ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("reject")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(error)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("        } ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("else")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("          ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("resolve")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(results)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("        }")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("      })")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("    })")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  }")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#88846F"}},[t._v("// extendDatabase 方法也可以直接传入一个数据库类")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#A6E22E"}},[t._v("extendDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(MysqlDatabase, {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#88846F"}},[t._v("// builtin methods")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("})")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("export")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("const")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" name ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#E6DB74"}},[t._v("'mysql'")])]),t._v("\n\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F92672"}},[t._v("export")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("function")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("apply")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("ctx")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Context")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(", ")]),a("span",{staticStyle:{color:"#FD971F"}},[t._v("config")]),a("span",{staticStyle:{color:"#F92672"}},[t._v(":")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("PoolConfig")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" {}) {")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ")]),a("span",{staticStyle:{color:"#66D9EF"}},[t._v("const")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" db ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("new")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("MysqlDatabase")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("(ctx.app, config)")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("  ctx.database ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("=")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" db ")]),a("span",{staticStyle:{color:"#F92672"}},[t._v("as")]),a("span",{staticStyle:{color:"#F8F8F2"}},[t._v(" ")]),a("span",{staticStyle:{color:"#A6E22E"}},[t._v("Database")])]),t._v("\n"),a("span",{staticClass:"line"},[a("span",{staticStyle:{color:"#F8F8F2"}},[t._v("}")])])])])]),a("p",[t._v("当然，真正的 "),a("RouterLink",{attrs:{to:"/api/database/mysql.html"}},[t._v("koishi-plugin-mysql")]),t._v(" 要比上面的例子复杂的多，我们还需要处理有关数据库的更多细节。你可以在 "),a("a",{attrs:{href:"https://github.com/koishijs/packages/plugin-mysql",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v(" 看到完整的源代码。")],1)],1)}),[],!1,null,null,null);s.default=c.exports}}]);